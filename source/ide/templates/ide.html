<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %} {{current_project.project_name}}/{{file_name}} {% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'ide.css' %}">
    <script src="{% static ide.js %}"></script>
</head>

<body>
<!-- project side-nav -->
<div class="side-nav shadow-end border-end border-dark">
    <button type="button" id="sidebarCollapse" class="btn mx-auto btn-dark mb-4">
        <i class="bi bi-folder2-open fs-5 text-light"></i>
    </button>

    <form method="post" action="{% url 'ide' project_id=current_project.id %}">
        {% csrf_token %}
        <input type="hidden" name="project_id" value="{{current_project.id}}">
        <button type="submit" class="btn btn-dark mx-auto mb-4" name="download_project">
            <i class="bi bi-download fs-5 text-light"></i>
        </button>
    </form>

    <button class="btn mx-auto btn-dark mb-4" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom"
        aria-controls="offcanvasBottom">
    <i class="bi bi-terminal fs-5 text-light"></i>
    </button>

    <a class="btn mx-auto btn-dark mb-4" href="{% url 'personal_profile' %}">
        <i class="bi bi-house fs-5 text-light"></i>
    </a>
</div>

<!-- Project Tree Form -->
<form method="post" enctype="multipart/form-data" action="{% url 'ide' project_id=current_project.id %}"
      class="sidebar active shadow-end border-end border-dark" id="sidebar">
    {% csrf_token %}
    <ul>
        {% for node in project_tree %}
        {% if node.type == 'directory' %}
        <li>
            <button class="btn btn-sm folder-btn" type="button" data-bs-toggle="collapse"
                    data-bs-target="#{{node.name|slugify}}" aria-expanded="true">
                <i class="bi bi-folder-plus"></i><i class="bi bi-folder-minus d-none"></i> {{node.name}}
            </button>
            <ul class="collapse show" id="{{node.name|slugify}}">
                {% for child in node.children %}
                {% if child.type == 'directory' %}
                <li>
                    <button class="btn btn-sm folder-btn" type="button" data-bs-toggle="collapse"
                            data-bs-target="#{{ child.name|slugify }}" aria-expanded="true">
                        <i class="bi bi-folder-plus"></i><i class="bi bi-folder-minus d-none"></i> {{child.name}}
                    </button>
                    <ul class="collapse show" id="{{ child.name|slugify }}">
                        {% for grandchild in child.children %}
                        {% if grandchild.type == 'file' %}
                        <li>
                            <button class="btn btn-sm file-item" type="submit" name="open_file" value="{{grandchild.path}}">
                                <i class="bi bi-file-earmark-code"></i> {{grandchild.name}}
                            </button>
                        </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                {% elif child.type == 'file' %}
                <li>
                    <button class="btn btn-sm file-item" type="submit" name="open_file" value="{{child.path}}">
                        <i class="bi bi-file-earmark-code"></i> {{child.name}}
                    </button>
                </li>
                {% endif %}
                {% endfor %}
            </ul>
        </li>
        {% elif node.type == 'file' %}
        <li>
            <button class="btn btn-sm file-item" type="submit" name="open_file" value="{{node.path}}">
                <i class="bi bi-file-earmark-code"></i> {{node.name}}
            </button>
        </li>
        {% endif %}
        {% endfor %}
    </ul>
</form>



<!--- This is the main CodeMirror IDE section including the nave buttons--->
<form method="post" enctype="multipart/form-data" action="" class="card ide-card border-0">
    {% csrf_token %}
    <input type="hidden" id="selectedThemeInput" name="selected_theme" value="default">
    <input type="hidden" id="selectedSyntaxInput" name="selected_syntax" value="auto">
    <input type="hidden" name="file_path" value="{{file_path}}">
    <input type="hidden" name="file_name" value="{{file_name}}">
    <input type="hidden" name="project_id" value="{{current_project.id}}">

    <div class="card-header shadow-end border-end border-dark">
        <div class="hstack gap-3 align-middle">
            <div class="p-1">
                <button class="btn folder-btn" data-bs-toggle="modal" data-bs-target="#RenameModal" type="reset">
                    <i class="bi bi-pencil"></i> {{file_name}}
                </button>
            </div>
            <div class="vr"></div>
            <div class="p-1">
                <button class="btn file-item" name="save_file" type="submit">
                    <i class="bi bi-save"></i> Save
                </button>
            </div>
            <div class="p-1">
                <button class="btn file-item" name="delete" type="submit">
                    <i class="bi bi-trash"></i> Delete
                </button>
            </div>
            <!-- Add dropdown buttons -->
            <div class=" ms-auto">
                <div class="dropdown">
                    <button class="btn btn-sm btn-dark dropdown-toggle" id="themeDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        Theme: <span id="currentTheme">Default</span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                        <li><a class="dropdown-item" onclick="changeTheme('default')">Light Mode</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('xq-light')">XQ Light</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('base16-light')">Base16 Light</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('eclipse')">Eclipse</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('3024-day')">3024 Day</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('solarized')">Solarized</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('paraiso-light')">Paraiso Light</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('mdn-like')">MDN Like</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('hopscotch')">Hopscotch</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('lucario')">Lucario</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('material')">Material</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('nord')">Nord</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('oceanic-next')">Oceanic Next</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('cobalt')">Cobalt</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('paraiso-dark')">Paraiso Dark</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('mbo')">MBO</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('panda-syntax')">Panda Syntax</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('monokai')">Monokai</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('seti')">Seti</a></li>
                        <li><a class="dropdown-item" onclick="changeTheme('tomorrow-night-bright')">Tomorrow Night Bright</a></li>
                    </ul>
                </div>
            </div>
            <div class="p-2">
                <div class="dropdown">
                    <button class="btn btn-sm btn-dark dropdown-toggle" type="button" id="syntaxDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        Syntax Highlighting: <span id="currentSyntax">Auto Detect</span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="syntaxDropdown">
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('autodetect')">Auto Detect</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('plain')">Plain Text</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('python')">Python</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('javascript')">JavaScript</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('html')">HTML</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('css')">CSS</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('java')">Java</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('c')">C</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('cpp')">CPP</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('php')">PHP</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('ruby')">Ruby</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('swift')">Swift</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('go')">Go</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('rust')">Rust</a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeSyntax('typescript')">TypeScript</a></li>
                        <!-- Add more syntax highlighting options as needed -->
                    </ul>
                </div>
            </div>

        </div>
    </div>
    <textarea name='file_contents' id="myTextarea" style="display: none;">{{file_content}}</textarea>
</form>
</body>

<!-- Terminal -->
<div class="offcanvas offcanvas-bottom h-50 rounded-0 bg-transparent overflow-hidden"
     tabindex="-1"
     id="offcanvasBottom"
     aria-labelledby="offcanvasBottomLabel"
     data-bs-backdrop="false">
    <div class="card terminal p-0">
        <div class="card-header terminal-header border border-dark text-light d-flex justify-content-between align-items-center">
            <span>Terminal</span>
            <div class="ml-auto">
                <button type="button" class="btn btn-dark fs-5" data-bs-dismiss="offcanvas">
                    <i class="bi bi-dash-lg text-light"></i>
                </button>
                <button id="toggleHeightButton" class="btn btn-dark fs-5" onclick="toggleOffcanvasHeight()">
                    <i class="bi bi-arrows-fullscreen text-light"></i>
                </button>
            </div>
        </div>
        <div class="card terminal rounded-0 border p-0 text-light border-dark">
            <div class="card-body">
                <div id="terminal" class="p-1 text-light">{{response}}</div>
                <form class="hstack" method="post" onsubmit="sendPrompt(); return false;">
                    {% csrf_token %}
                    <div class="prompt p-1 text-light">
                      <span class="username">user@Ubuntu</span>:<span class="path">~/UserProjects/{{ current_project.project_name }}</span>$
                    </div>
                    <input name="terminalInput" class="terminal-input border-0 text-light" autocomplete="off">
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Modal for renaming file-->
<div class="modal fade modal-dark" id="renameModal" tabindex="-1" aria-labelledby="renameModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="renameModalLabel">Rename</h1>
            </div>
            <form method="post" enctype="multipart/form-data" action="{% url 'ide' project_id=current_project.id %}" class="modal-body">
                {% csrf_token %}
                <input type="text" name="new_file_name" value="{{ file_name }}"
                       class="form-control bg-dark text-light border-secondary mb-4">
                <input type="hidden" name="file_path" value="{{ file_path }}">
                <input type="hidden" name="file_contents" value="{{ file_content }}">
                <input type="hidden" name="project_id" value="{{ current_project.id }}">
                <button type="submit" name="rename_file" class="btn btn-primary">Save changes</button>
            </form>
        </div>
    </div>
</div>


<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- CodeMirror js and css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.css">
<!-- JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.js"></script>

<!-- Here are all the links to the different syntax highlighting for CodeMirror -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/plain/plain.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/addon/mode/multiplex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/clike/clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/php/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/ruby/ruby.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/swift/swift.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/go/go.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/rust/rust.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/typescript/typescript.min.js"></script>

<!-- Here are all the links to the different themes for CodeMirror -->
<!-- XQ Light -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/xq-light.min.css">
<!-- Base16 Light -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/base16-light.min.css">
<!-- Paraiso Light -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/paraiso-light.min.css">
<!-- MDN Like -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/mdn-like.min.css">
<!-- Tomorrow Night Bright -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/tomorrow-night-bright.min.css">
<!-- Hopscotch -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/hopscotch.min.css">
<!-- Lucario -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/lucario.min.css">
<!-- Solarized -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/solarized.min.css">
<!-- 3024 Day -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/3024-day.min.css">
<!-- Material -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/material.min.css">
<!-- Nord -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/nord.min.css">
<!-- Oceanic Next -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/oceanic-next.min.css">
<!-- Panda Syntax -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/panda-syntax.min.css">
<!-- Paraiso Dark -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/paraiso-dark.min.css">
<!-- Seti -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/seti.min.css">
<!-- Cobalt -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/cobalt.min.css">
<!-- Eclipse -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/eclipse.min.css">
<!-- MBO -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/mbo.min.css">
<!-- Monokai -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/theme/monokai.min.css">


<script>
    // Store the collapse state in an object
    let collapseState = {};

    // Function to update the project tree
    function updateProjectTree() {
        // Before updating the tree, store the current state of collapse elements
        document.querySelectorAll('.collapse').forEach(collapseElement => {
            const id = collapseElement.id;
            collapseState[id] = collapseElement.classList.contains('show');
        });

        // Save the scroll position of the sidebar to avoid shifting
        const sidebar = document.querySelector('#sidebar');
        const scrollPosition = sidebar.scrollTop;

        fetch(window.location.href, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',  // This tells Django it's an AJAX request
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.project_tree) {
                const treeContainer = document.querySelector('#sidebar ul');
                treeContainer.innerHTML = ''; // Clear the existing tree

                // Generate new tree HTML
                const treeHTML = generateTreeHTML(data.project_tree);
                treeContainer.innerHTML = treeHTML;

                // Reapply the saved collapse state
                document.querySelectorAll('.collapse').forEach(collapseElement => {
                    const id = collapseElement.id;
                    if (collapseState[id]) {
                        // If the state was 'expanded', reapply the 'show' class
                        collapseElement.classList.add('show');
                    } else {
                        // Otherwise, collapse it
                        collapseElement.classList.remove('show');
                    }
                });

                // Reinitialize collapse buttons
                document.querySelectorAll('.btn.folder-btn').forEach(button => {
                    const targetCollapse = document.querySelector(button.getAttribute('data-bs-target'));
                    if (targetCollapse && targetCollapse.classList.contains('show')) {
                        button.setAttribute('aria-expanded', 'true');
                    } else {
                        button.setAttribute('aria-expanded', 'false');
                    }
                });

                // Reapply the scroll position to prevent visual movement
                sidebar.scrollTop = scrollPosition;
            }
        })
        .catch(error => console.error('Error fetching project tree:', error));
    }

    // Function to generate tree HTML from the project tree structure
    function generateTreeHTML(nodes) {
        let html = '';
        nodes.forEach(node => {
            if (node.type === 'directory') {
                html += `<li>
                            <button class="btn btn-sm folder-btn" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#${slugify(node.name)}" aria-expanded="false">
                                <i class="bi bi-folder-plus"></i><i class="bi bi-folder-minus d-none"></i> ${node.name}
                            </button>
                            <ul class="collapse" id="${slugify(node.name)}">
                                ${generateTreeHTML(node.children)}  <!-- Recursive call -->
                            </ul>
                          </li>`;
            } else if (node.type === 'file') {
                html += `<li>
                            <button class="btn btn-sm file-item" name="open_file" value="${node.path}" type="submit">
                                <i class="bi bi-file-earmark-code"></i> ${node.name}
                            </button>
                          </li>`;
            }
        });
        return html;
    }

    // Function to safely create slugs for the element IDs
    function slugify(text) {
        return text.toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '');
    }

    // Update the project tree every 5 seconds
    setInterval(updateProjectTree, 3000);
</script>








<script>

var editor;

function changeTheme(theme) {
    editor.setOption("theme", theme);
    document.getElementById('currentTheme').textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
    document.getElementById('selectedThemeInput').value = theme;
}

function changeSyntax(mode) {
    editor.setOption("mode", mode);
    document.getElementById('currentSyntax').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
    document.getElementById('selectedSyntaxInput').value = mode;
}

document.addEventListener("DOMContentLoaded", function () {
    editor = CodeMirror.fromTextArea(document.getElementById("myTextarea"), {
        lineNumbers: true,
        mode: "autodetect",
        theme: "default",
        autoCloseBrackets: true,
        matchBrackets: true
    });
    editor.setSize(null, "100%");

    var initialTheme = "{{ current_project.selected_theme }}";
    var initialSyntax = "{{ current_project.selected_syntax }}";

    if (initialTheme !== "default") {
        changeTheme(initialTheme);
    }
    if (initialSyntax !== "auto") {
        changeSyntax(initialSyntax);
    }
});

document.getElementById("sidebarCollapse").addEventListener("click", function () {
    document.getElementById("sidebar").classList.toggle("active");
});

document.querySelectorAll('.collapse').forEach(function(collapse) {
    collapse.addEventListener('show.bs.collapse', function() {
        this.previousElementSibling.querySelector('.bi-folder-plus').classList.add('d-none');
        this.previousElementSibling.querySelector('.bi-folder-minus').classList.remove('d-none');
    });

    collapse.addEventListener('hide.bs.collapse', function() {
        this.previousElementSibling.querySelector('.bi-folder-plus').classList.remove('d-none');
        this.previousElementSibling.querySelector('.bi-folder-minus').classList.add('d-none');
    });
});


// AJAX used to send and receive the terminal prompts and responses
function sendPrompt() {
    const promptValue = document.querySelector('.terminal-input').value.trim();
    if (!promptValue) return;

    // Add the command to history and reset index
    commandHistory.push(promptValue);
    historyIndex = commandHistory.length;

    const formData = new FormData();
    formData.append('prompt', promptValue);

    const terminalDiv = document.getElementById('terminal');
    const projectName = "{{ current_project.project_name }}";

    // Append the user's command in terminal-like format
    terminalDiv.innerHTML += `<div>
        <span class="username">user@Ubuntu</span>:<span class="path">~/UserProjects/${projectName}</span>$ ${promptValue}
    </div>`;

    if (promptValue.toLowerCase() === 'clear') {
        terminalDiv.innerHTML = ''; // Clear the terminal
        document.querySelector('.terminal-input').value = ''; // Clear the input field
        return; // Exit the function
    }

    fetch('', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': '{{ csrf_token }}' // Include CSRF token for Django
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log(data); // Log response to console for debugging

        if (data.input_prompt) {
            // If the backend has sent an 'input_prompt', display it for user input
            const inputDiv = document.createElement('div');
            inputDiv.innerHTML = `<span class="output">${data.input_prompt}</span>`;
            terminalDiv.appendChild(inputDiv);

            // Focus on the input field to allow the user to respond
            document.querySelector('.terminal-input').focus();
        } else {
            // Format response with new lines for better terminal output style
            const formattedResponse = data.response
                .split('\n') // Split response by newlines
                .map(line => `<div><span class="output">${line}</span></div>`) // Wrap each line in a div
                .join('');

            // Append the formatted response to the terminal UI
            terminalDiv.innerHTML += formattedResponse;

            // Scroll to the bottom of the terminal
            terminalDiv.scrollTop = terminalDiv.scrollHeight;

            // Clear the input field after processing
            document.querySelector('.terminal-input').value = '';
        }
    })
    .catch(error => console.error('Error:', error));
}

let commandHistory = [];
let historyIndex = -1;

// Handle command history navigation
document.querySelector('.terminal-input').addEventListener('keydown', (e) => {
    if (e.key === 'ArrowUp') {
        // Navigate up the history
        if (historyIndex > 0) historyIndex--;
        e.target.value = commandHistory[historyIndex] || '';
        e.preventDefault(); // Prevent default cursor movement
    } else if (e.key === 'ArrowDown') {
        // Navigate down the history
        if (historyIndex < commandHistory.length - 1) historyIndex++;
        e.target.value = commandHistory[historyIndex] || '';
        e.preventDefault();
    }
});


function toggleOffcanvasHeight() {
    const offcanvasElement = document.getElementById('offcanvasBottom');
    if (offcanvasElement.classList.contains('h-50')) {
        offcanvasElement.classList.remove('h-50');
        offcanvasElement.classList.add('h-100');
    } else {
        offcanvasElement.classList.remove('h-100');
        offcanvasElement.classList.add('h-50');
    }
}




</script>
</html>
